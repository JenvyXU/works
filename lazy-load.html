<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片懒加载</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    ul,
    ol {
      list-style: none;
    }

    .title h1 {
      text-align: center;
      margin: 20px 0;
      color: #444;
    }

    .content {
      width: 672px;
      border: 1px solid #ddd;
      margin: 20px auto;

    }

    .content>ul>li {
      border: 1px solid #eee;
      float: left;
      margin: 10px 10px 40px 10px;
    }
    .content p{
      color:#333;
      text-align: center;
      margin: 10px 0;
    }

    .content img {
      display: inline-block;
      vertical-align: middle;
      width: 200px;
      height: 200px;
      clear: both;

    }

    .clearfix::after {
      content: '';
      display: block;
      clear: both;
    }
  </style>
</head>

<body>
  <div class="title">
    <h1>图片懒加载</h1>
  </div>
  <div class="content">
    <ul class="clearfix">
      <li>
        <img src="./default.gif" alt="">
        <p>图片1</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片2</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片3</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片4</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片5</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片6</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片7</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片8</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片9</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片10</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片11</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片12</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片13</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片14</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片15</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片16</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片17</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片18</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片19</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片20</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片21</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片22</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片23</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片24</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片25</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片26</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片27</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片28</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片29</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片30</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片31</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片32</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片33</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片34</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片35</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片36</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片37</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片38</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片39</p>
      </li>
      <li>
        <img src="./default.gif" alt="">
        <p>图片40</p>
      </li>
  
    </ul>
  </div>
  <script src="./vendors/jquery.min.js">
  </script>
  <script>
    //给每个图片设置data-src
    $('.content img').each(function (index, e) {
      let url = 'https://picsum.photos/200/200?image=' + index
      $(this).attr('data-src', url)
    })

    start()

    $(window).on('scroll', function () {
      start()
    })
    
    function start() {
      $('.content img').not('[data-isLoaded]').each(function () {
        var $node = $(this)
        if (isShow($node)) {
          setTimeout(function () {
            loadImg($node)
          }, 500)
        }
      })
    }
    function isShow($node) {
      return $node.offset().top <= $(window).height() + $(window).scrollTop()
    }
    function loadImg($img) {
      $img.attr('src', $img.attr('data-src'))
      $img.attr('data-isLoaded', 1)
    }
  </script>
</body>

</html>